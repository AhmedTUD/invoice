# 🔧 إصلاح مشكلة الأعمدة في Excel

## 🎯 المشكلة:
اسم الفرع كان يظهر في عمود "صورة الفاتورة" بدلاً من أن يكون في أعلى الشيت.

## 🔍 السبب:
كان ترتيب الكود خاطئ - تم تعريف الأعمدة بعد إضافة معلومات الفرع، مما أدى إلى تداخل البيانات.

## ✅ الحل:
إعادة ترتيب الكود بحيث:

### 1. **تعريف الأعمدة أولاً**:
```typescript
storeSheet.columns = [
    { header: 'اسم الموظف', key: 'employeeName', width: 20 },
    { header: 'كود الموظف', key: 'employeeSerial', width: 15 },
    // ... باقي الأعمدة
];
```

### 2. **ثم إضافة معلومات الفرع**:
```typescript
// الصف الأول: اسم الفرع
storeSheet.mergeCells('A1:G1');
const storeNameCell = storeSheet.getCell('A1');
storeNameCell.value = `🏢 ${storeName}`;

// الصف الثاني: كود الفرع
storeSheet.mergeCells('A2:G2');
const storeCodeCell = storeSheet.getCell('A2');
storeCodeCell.value = `🏷️ كود الفرع: ${storeCode}`;

// الصف الثالث: الإحصائيات
storeSheet.mergeCells('A3:G3');
const statsCell = storeSheet.getCell('A3');
statsCell.value = `👥 عدد الموظفين: ${uniqueEmployees} | 📋 عدد الفواتير: ${storeRecords.length}`;
```

### 3. **ثم إعادة تعريف الهيدر**:
```typescript
const headerRow = storeSheet.getRow(5);
headerRow.values = {
    employeeName: 'اسم الموظف',
    employeeSerial: 'كود الموظف',
    // ... باقي الهيدر
};
```

### 4. **أخيراً البيانات**:
```typescript
let currentRow = 6; // البدء من الصف 6
for (const record of storeRecords) {
    const row = storeSheet.getRow(currentRow);
    row.values = {
        employeeName: record.name,
        // ... باقي البيانات
    };
}
```

## 📊 الشكل الصحيح الآن:

```
┌─────────────────────────────────────────────────────────────────────┐
│                        🏢 فرع القاهرة                              │ ← صف 1 (مدمج A1:G1)
├─────────────────────────────────────────────────────────────────────┤
│                    🏷️ كود الفرع: CAI-01                           │ ← صف 2 (مدمج A2:G2)
├─────────────────────────────────────────────────────────────────────┤
│  👥 عدد الموظفين: 3 | 📋 عدد الفواتير: 12 | 📅 تاريخ التقرير: 19/01/2026  │ ← صف 3 (مدمج A3:G3)
├─────────────────────────────────────────────────────────────────────┤
│                              (فارغ)                                │ ← صف 4
├─────────────────────────────────────────────────────────────────────┤
│ اسم الموظف │ كود الموظف │ الموبايل │ الموديل │ التاريخ │ الملف │ الصورة │ ← صف 5 (هيدر)
├─────────────────────────────────────────────────────────────────────┤
│ أحمد محمد   │ EMP-001    │ 0123...  │ RS68... │ 19/01  │ ...   │ [🖼️]   │ ← صف 6 (بيانات)
│ سارة أحمد   │ EMP-002    │ 0124...  │ WW11... │ 18/01  │ ...   │ [🖼️]   │ ← صف 7 (بيانات)
└─────────────────────────────────────────────────────────────────────┘
```

## 🎯 النتيجة:
- ✅ اسم الفرع في المكان الصحيح (أعلى الشيت)
- ✅ كود الفرع واضح ومميز
- ✅ الإحصائيات منظمة
- ✅ الهيدر في مكانه الصحيح
- ✅ البيانات تبدأ من الصف الصحيح
- ✅ الصور في العمود الصحيح

## 🧪 للاختبار:
1. اذهب إلى: `http://localhost:3000/#/admin`
2. اضغط "Excel متقدم (شيتات منفصلة)"
3. افتح الملف وتحقق من أن:
   - اسم الفرع في أعلى الشيت
   - كود الفرع تحته مباشرة
   - الهيدر في الصف الخامس
   - البيانات تبدأ من الصف السادس
   - الصور في العمود الأخير

**المشكلة محلولة الآن! 🎉**